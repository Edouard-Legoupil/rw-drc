<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Internews - 404</title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1038.36">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
    span.Apple-tab-span {white-space:pre}
  </style>
</head>
<body>
<p class="p1">## Mapping Conflict in the DRC</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">This documentation is divded into two parts. The first section covers how to set up github and fork the project, and explains the site architecture with file descriptions. The second section backs up to data processing and map design by providing links to tools to download, and docs for working with SQLite and Tilemill.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">##Github and Site Architecture</p>
<p class="p2"><br></p>
<p class="p1">###Setting up Github</p>
<p class="p1"><span class="Apple-converted-space"> </span>- [Create an account](https://github.com/signup/free)</p>
<p class="p1"><span class="Apple-converted-space"> </span>- [Set up Git](http://help.github.com/mac-set-up-git/)</p>
<p class="p1"><span class="Apple-converted-space"> </span>- [Forking a repository](http://help.github.com/fork-a-repo/)</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">### Forking the project</p>
<p class="p1">To use this project as a starting point, [fork the repository](http://help.github.com/fork-a-repo). This will create a new copy of the project on github. Make changes by setting up a local repo by cloning it to the file or directory that you desire, and then from there you can make changes and commit/push them to github. For example, I have a local github folder that I navigate to with `cd Documents/github/` to clone all github projects. Then i navigate into the spcecific project to commit and push changes.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">###Files</p>
<p class="p1">-----</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>_includes/ <span class="Apple-converted-space">    </span>Javascript and css files.</p>
<p class="p1"><span class="Apple-converted-space">    </span>_layouts/<span class="Apple-converted-space">      </span>Major page templates.</p>
<p class="p1"><span class="Apple-converted-space">    </span>_posts/<span class="Apple-converted-space">        </span>Content. Data, sources, about.</p>
<p class="p1"><span class="Apple-converted-space">    </span>_site/ <span class="Apple-converted-space">        </span>The static site generated by Jekyll.</p>
<p class="p1"><span class="Apple-converted-space">    </span>data/<span class="Apple-converted-space">          </span>Csv and json files of data for drawer.</p>
<p class="p1"><span class="Apple-converted-space">    </span>fonts/ <span class="Apple-converted-space">        </span>Fonts.</p>
<p class="p1"><span class="Apple-converted-space">    </span>images/<span class="Apple-converted-space">        </span>Images.</p>
<p class="p1"><span class="Apple-converted-space">    </span>tilemill/<span class="Apple-converted-space">      </span>Internews-media tilemill project.</p>
<p class="p1"><span class="Apple-converted-space">    </span>404.html <span class="Apple-converted-space">      </span>Custom 404 page - only works with gh-pages.</p>
<p class="p1"><span class="Apple-converted-space">    </span>CNAME<span class="Apple-converted-space">          </span>CNAME record. See http://pages.github.com under 'Custom domains' to see how this works with github pages</p>
<p class="p1"><span class="Apple-converted-space">    </span>README.md<span class="Apple-converted-space">      </span>This file.</p>
<p class="p1"><span class="Apple-converted-space">    </span>_config.yml<span class="Apple-converted-space">    </span>Jekyll configuration file.</p>
<p class="p1"><span class="Apple-converted-space">    </span>404.html <span class="Apple-converted-space">      </span>Custom 404 page - only works with gh-pages.</p>
<p class="p1"><span class="Apple-converted-space">    </span>import.rb<span class="Apple-converted-space">      </span>An import script designed to split the data from csv into indivdual .json files per province</p>
<p class="p1"><span class="Apple-converted-space">    </span>index.html <span class="Apple-converted-space">    </span>Home page.</p>
<p class="p1"><span class="Apple-converted-space">    </span>site.css <span class="Apple-converted-space">      </span>Aggregated site css.</p>
<p class="p1"><span class="Apple-converted-space">    </span>site.js<span class="Apple-converted-space">        </span>Aggregated site scripts.</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">###Jekyll</p>
<p class="p1">The site uses Jekyll, a simple, logic aware, static site generator. In a nutshell you build a site with all the logic and source files you need and Jekyll creates a static copy of the website in a '_site/' directory. Note that you do not touch the contents of this directory. You make any additions or changes to the files outside of this.</p>
<p class="p2"><br></p>
<p class="p1">Make sure you have [Xcode](https://developer.apple.com/technologies/tools/) installed before installing Jekyll. This is available for free in the Apple App store.<span class="Apple-converted-space">  </span>Once this is complete you should be able to run:<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">- `gem install jekyll`</p>
<p class="p2"><br></p>
<p class="p1">If this doesn't work, read documentation [available here](https://github.com/mojombo/jekyll/wiki/install) about updating your ruby packages.</p>
<p class="p2"><br></p>
<p class="p1">Once jekyll is installed, and you have downloaded the project, from terminal, navigate into the directory the project is in and type 'jekyll'. Locally, the site can be viewed at `http://0.0.0.0:4000/index.html` in any browser after it has been generated for the first time. This allows you to make local changes that are automatically reflected in your local version of the site, as long as jekyll is running in your terminal. To stop jekyll, type 'command c'.</p>
<p class="p2"><br></p>
<p class="p1">####Site Configuration</p>
<p class="p1">`_config.yml` sets up the default configuration for jekyll when reading all files. As seen below, it allows you to format the url, and allows for the exclusion of unnecessary files that jekyll doesn't need to generate.</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>auto: true</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>server: true</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>exclude:</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>- README.md</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>- import.rb</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>- tilemill</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>permalink: /:title</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>baseurl: /internews-media</p>
<p class="p2"><br></p>
<p class="p1">####Adding new pages</p>
<p class="p1">Jekyll allows for easy referencing and adding logic for other pages in the header of each new page that you create. For our use case, in `0200-01-02-about.html`, the header includes several options:</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>title: About the Data</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>category: about</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>tags: about</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>layout: pages</p>
<p class="p2"><br></p>
<p class="p1">We reference posts with 'tags' and 'category' to control their display from the template pages located in '_layouts/'. The logic contained in these template files uses Liquid. You can learn more about the [Liquid Templating System](https://github.com/shopify/liquid/wiki/liquid-for-designers) for more information on creating relationships between files in the `_site` directory.</p>
<p class="p2"><br></p>
<p class="p1">####Naming conventions</p>
<p class="p1">Jekyll has a default chronological pagination system. Posts are ordered such that the most *recent* post appears first, so we created fake dates to ensure hierarchy between the 'About' and 'Sources' links in the _posts directory.</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>hierarchy<span class="Apple-converted-space">    </span>file name</p>
<p class="p1"><span class="Apple-converted-space">    </span>-------- <span class="Apple-converted-space">    </span>---------</p>
<p class="p1"><span class="Apple-converted-space">     </span>1 <span class="Apple-converted-space">          </span>0200-01-02-about.html</p>
<p class="p1"><span class="Apple-converted-space">     </span>2 <span class="Apple-converted-space">          </span>0200-01-01-data.html</p>
<p class="p1"><span class="Apple-converted-space">     </span>2<span class="Apple-converted-space">       <span class="Apple-tab-span">	</span> </span>0200-01-01-sources.html</p>
<p class="p2"><br></p>
<p class="p1">###Notes</p>
<p class="p1">Where something requires explanation there are inline notes in the code.</p>
<p class="p2"><br></p>
<p class="p1">##Data Processing</p>
<p class="p1">[This tutorial](http://mapbox.com/tilemill/docs/tutorials/SQLite-work/) walks through turning data sources into SQLite files. This requires downloading [Quantum GIS](www.qgis.org), and [Tilemill](www.tilemill.com).</p>
<p class="p2"><br></p>
<p class="p1">Qgis is a powerful tool for working with geographic files, but for right now we just want it to convert data formats like csvs and shapefiles into SQLite databases.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">SQLite databases are the best tool for sorting data in Tilemill. SQLite lets you change the query on the data whenever you like, to find a different angle on your data. It is also an easy way to join databases with geographic information to those without geographic information, in the `attach db` field of the `add SQLite layer` in Tilemill. This process is outlined in the same [tutorial](http://mapbox.com/tilemill/docs/tutorials/SQLite-work/) as above.</p>
<p class="p2"><br></p>
<p class="p1">For example, with the LRA attacks and security incidents against humanitarian workers, I saved the original files as csvs, then imported them into QGIS. Then I saved the layers as SQLite databases.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">Since I want to aggregate my LRA incidents by the district level, I need points that correspond to each district. So I looked at the admin2 shapefile from the `cod_boundaries`, which has district information.<span class="Apple-converted-space">  </span>In QGIS I add a vector layer and open up this `admin2.shp` file. This opens up polygons, but I don't want to join my LRA or security incidents to polygons, since I was display them as events by location.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">To turn the polygons into centroids, I went to `vector, geometry tools, polygons to centroids.' Then I right-clicked on the shapefile and saved the layer as a SQLite database, and set the CRS (map projection) to google mercator, since this is what Tilemill by default uses.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">Now you should have two SQLite databases, one for LRA attacks, and one for admin2 centroids. In Tilemill you will go to `add a layer`, choose `SQLite` and open up the admin2 centroids file. Then in the `attach DB` field, you will navigate to your LRA attacks file. The join between these two databases happens in the query field, and looks similar to this:<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>(select *,</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>count(unique_id) as num_attacks,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>sum(ppl_killed) as ppl_killed,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>sum(infants_kidnapped) as infants_kidnapped, <span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>sum(adults_kidnapped) as adults_kidnapped</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>from<span class="Apple-converted-space">  </span>`admin3_centroids` a join `lra_attack` b</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>on b.territory=a.nom</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>group by month, territory</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>)</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p1">The asterisk means select all, and the following rows are counting or adding data so that as we aggregate by district, we won't lose individual information about each attack. This yield a table with a row for each territory of each month in the data with aggregated attacks, people killed, and people kidnapped.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">##Map Design<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">This comes much easier, as it follows a css-type like language called carto. All of the basics and more advanced options of styling your data can be found in the [mapbox.com/help](http://mapbox.com/help), starting with [styling data](http://mapbox.com/tilemill/docs/crashcourse/styling/) section.</p>
<p class="p2"><br></p>
<p class="p1">##Google image chart Graphs</p>
<p class="p2"><br></p>
<p class="p1">The charts that show up on the side bar in the site are created in the [google image chart wizard](https://developers.google.com/chart/image/docs/chart_wizard), which allows you to change the margins, styling and size of different kinds of charts.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">However you can easily recreate the charts in the DRC site with the same styling by changing the URLs inserted in the &lt;img&gt; tags within &lt;div='graphs'&gt;. These are tagged with &lt;class='year2010'&gt; or &lt;class='2011'&gt; etc., which is read by the javascript to know when to appear with the year selector. See below:</p>
<p class="p2"><br></p>
<p class="p1">![](https://img.skitch.com/20120406-d6qh7aff173a16ktkun745xer1.jpg)</p>
<p class="p2"><br></p>
<p class="p1">These three image tags result in three unique graphs. The data and parameters are defined by the different tags within the URL, and separated by the `&amp;` symbol. Below are the three parameters that must be changed in order to create a new URL for a graph. More information about the other components of these charts can [be found here](https://developers.google.com/chart/image/docs/chart_params).</p>
<p class="p2"><span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space"> </span>- the title, `chtt=`</p>
<p class="p1"><span class="Apple-converted-space"> </span>- the data, `chd=t:`<span class="Apple-converted-space">  </span>the different data sets represented here are seperated by a pipe `|`</p>
<p class="p1"><span class="Apple-converted-space"> </span>- the img class (to match the year of the data you're inserting)</p>
<p class="p2"><span class="Apple-converted-space"> </span></p>
<p class="p1">![](https://img.skitch.com/20120406-x3715g5spckk9utppr4239khb6.jpg)</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">##Changing the Returnee and IDP Totals</p>
<p class="p2"><br></p>
<p class="p1">![](https://img.skitch.com/20120509-jupetxn7ch2sh9whw91i2fc67k.jpg)</p>
<p class="p2"><br></p>
<p class="p1">The totals are just like the Google image charts, which have classes to determine what year they appear on, for example `&lt;class='year2010'&gt;` or `&lt;class='2011'&gt;`.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">It's also essential to add `style="display: none;` so that all of the numbers don't display on page load. This can be seen below from the file `map-interactive.html`, with arrows pointing to where you add the new numbers. These numbers were collected by running a query on the appropriate IDP and Returnee files to add the numbers for a given year.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">![](https://img.skitch.com/20120509-fgc4j8gkktks2kh2bhmbym2yae.jpg)</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">##Updating JSON Files to Populate the Tables</p>
<p class="p2"><br></p>
<p class="p1">To update the tables and maps for new data, such as 2012 data, you need to start by adding a the appropriate option to the year selector from the "map-interactive.html" file. The new line is in bold, and for the map to load with 2012 selected, you need to move the 'selected' parameter to 2012 as well.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space"> </span>&lt;select id='year-select'&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;option value='2011'&gt;2011&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;option value='2010'&gt;2010&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>**&lt;option value='2012 selected='selected''&gt;2012&lt;/option&gt;**</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/select&gt;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1">Then you need to change the default year in the site.js file to 2012 instead of 2011 on [line 21](https://github.com/RWMaps/rw-drc/blob/gh-pages/_includes/js/site.js#L21).</p>
<p class="p2"><br></p>
<p class="p1">**var year = year || '2012';**</p>
<p class="p2"><br></p>
<p class="p1">In the `layers.js` file, add 2012 data (pointing to the 2012 layers), which will directly inform which JSON files are searched for to fill the table. Here is an example of the new [layers.js](https://gist.github.com/1e0a30a59a514a1069a2) file with new values for 2012. These map layers don't exist yet, but it is what they should be named once created. <span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">Lastly, you need to create the new JSON files. This can be done by updating the data, "idp.csv, sec.csv, lra.csv, and ret.csv" files and then running the import.rb script. Here is a [brief tutorial](http://ruby.about.com/od/tutorials/a/commandline_2.htm) on running ruby scripts in your command line. The script was custom written to import the specific formats of each csv and turn them into JSONs, so it is essential that the new data matches the original format of each csv.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">The tables will only populate if the data layers are appropriately filled out in `layers.js` with a corresponding valid JSON in `data/JSON` for each layer. If even one of these JSONs is missing or invalid, the whole table will break, even though the map still loads any layers.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">The other option is to manually create JSONs for each month for 2012, by copying and pasting the format for each type (lra, idp, sec, ret) into a new file, and changing the values. For example, you can create a new file in the data/json directory called idp-jan-12.json, and fill it with new values, so long as this matches the same format set up in the 2011 JSONs.</p>
<p class="p2"><br></p>
<p class="p1">##Updating the world map baselayer</p>
<p class="p2"><br></p>
<p class="p1">The world map is originally set with a baselayer ([releifweb.africa](https://tiles.mapbox.com/reliefweb/map/africa)) and a borders layer ([reliefweb.drc-borders](https://tiles.mapbox.com/reliefweb/map/drc-borders)). These can both be easily changed in the [site.js](https://github.com/RWMaps/rw-drc/blob/gh-pages/_includes/js/site.js#L26) file</p>
<p class="p2"><br></p>
<p class="p1">Note that the two layers are separated by a comma, if you upload one baselayer that includes both the base map and borders, you will only need one map layer with no ending commas.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">Use the MapBox [create a map](http://mapbox.com/help/#creating_a_new_map) feature to create a custom world base map that can have terrain, labels turned on or off, and any color for the ocean and land. Then when you are done, click save, and then embed. This will pull up a window that has the tilejson url that you need, such as mine seen below. However the reliefweb account will look like reliefweb.map-xxxxxx.</p>
<p class="p2"><br></p>
<p class="p1">![](https://img.skitch.com/20121004-xdq78jewf5kadrdy98e3fcyp78.jpg).<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">This tilejson url replaces the current layers in the site.js file.<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1">The custom layer made by Relief Web can be combined with an custom MapBox basemap that just has the ocean, as done here in [this example](http://d.tiles.mapbox.com/v3/djohnson.map-m9l4eaq3,reliefweb.1_AVMU_World.html#5.00/10.674/34.673).<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
</body>
</html>
